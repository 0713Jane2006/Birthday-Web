<!DOCTYPE html>
<html>
<body>
  <audio 
    id="bgMusic" 
    src="五月天 - 如果我们不曾相遇 (Live)_L (V0).mp3" 
    preload="auto">
  </audio>

  <script>
    const audio = document.getElementById('bgMusic');
    const STORAGE_KEY = 'musicState'; 

    window.addEventListener('load', () => {
      const savedState = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      
      if (savedState.currentTime) {
        audio.currentTime = savedState.currentTime;
      }
      
      if (savedState.isPlaying) {
        audio.play().catch(err => {
          document.addEventListener('click', () => audio.play(), { once: true });
        });
      }
    });

    audio.addEventListener('play', () => {
      updateStorage(true);
    });
    audio.addEventListener('pause', () => {
      updateStorage(false);
    });
    audio.addEventListener('timeupdate', () => {
      updateStorage(audio.paused ? false : true);
    });

    function updateStorage(isPlaying) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({
        isPlaying: isPlaying,
        currentTime: audio.currentTime
      }));
    }
  </script>
</body>
</html>
